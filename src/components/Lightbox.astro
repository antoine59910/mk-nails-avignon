---
// Lightbox component - self-contained with scoped styles and inline JS
---

<div id="lightbox" class="lightbox" aria-hidden="true" role="dialog" aria-modal="true">
  <div class="lightbox-backdrop" id="lightbox-backdrop"></div>

  <button class="lightbox-close" id="lightbox-close" aria-label="Fermer" tabindex="-1">
    <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
      <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
    </svg>
  </button>

  <button class="lightbox-nav lightbox-prev" id="lightbox-prev" aria-label="Image precedente" tabindex="-1">
    <svg xmlns="http://www.w3.org/2000/svg" class="w-8 h-8" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
      <path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7" />
    </svg>
  </button>

  <button class="lightbox-nav lightbox-next" id="lightbox-next" aria-label="Image suivante" tabindex="-1">
    <svg xmlns="http://www.w3.org/2000/svg" class="w-8 h-8" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
      <path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7" />
    </svg>
  </button>

  <div class="lightbox-content">
    <img id="lightbox-image" src="" alt="" class="lightbox-image" />
    <p class="lightbox-caption" id="lightbox-caption"></p>
  </div>
</div>

<style>
  .lightbox {
    position: fixed;
    inset: 0;
    z-index: 100;
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.3s ease;
  }

  .lightbox.active {
    opacity: 1;
    pointer-events: auto;
  }

  .lightbox-backdrop {
    position: absolute;
    inset: 0;
    background: rgba(0, 0, 0, 0.92);
    cursor: pointer;
  }

  .lightbox-close {
    position: absolute;
    top: 1.25rem;
    right: 1.25rem;
    z-index: 102;
    color: white;
    background: transparent;
    border: none;
    padding: 0.5rem;
    cursor: pointer;
    opacity: 0.6;
    transition: opacity 0.2s;
  }

  .lightbox-close:hover { opacity: 1; }

  .lightbox-nav {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    z-index: 102;
    color: white;
    background: transparent;
    border: none;
    padding: 0.75rem;
    cursor: pointer;
    opacity: 0.5;
    transition: opacity 0.2s;
  }

  .lightbox-nav:hover { opacity: 1; }
  .lightbox-nav:disabled { opacity: 0.15; cursor: default; }
  .lightbox-prev { left: 0.75rem; }
  .lightbox-next { right: 0.75rem; }

  .lightbox-content {
    position: relative;
    z-index: 101;
    max-width: 90vw;
    max-height: 90vh;
    display: flex;
    flex-direction: column;
    align-items: center;
  }

  .lightbox-image {
    max-width: 100%;
    max-height: 82vh;
    object-fit: contain;
    border-radius: 0.75rem;
  }

  .lightbox-caption {
    margin-top: 1rem;
    color: rgba(255, 255, 255, 0.7);
    font-size: 0.875rem;
    text-align: center;
  }

  @media (max-width: 768px) {
    .lightbox-nav { padding: 0.5rem; }
    .lightbox-prev { left: 0.25rem; }
    .lightbox-next { right: 0.25rem; }
  }
</style>

<script>
  const lightbox = document.getElementById('lightbox');
  const lbImage = document.getElementById('lightbox-image') as HTMLImageElement;
  const lbCaption = document.getElementById('lightbox-caption');
  const closeBtn = document.getElementById('lightbox-close');
  const prevBtn = document.getElementById('lightbox-prev') as HTMLButtonElement;
  const nextBtn = document.getElementById('lightbox-next') as HTMLButtonElement;
  const backdrop = document.getElementById('lightbox-backdrop');

  let idx = 0;
  let imgs: { src: string; alt: string; caption: string }[] = [];

  function init() {
    const triggers = document.querySelectorAll('[data-lightbox-trigger]');
    imgs = Array.from(triggers).map(el => ({
      src: el.getAttribute('data-lightbox-src') || '',
      alt: el.getAttribute('data-lightbox-alt') || '',
      caption: el.getAttribute('data-lightbox-caption') || ''
    }));
    triggers.forEach((el, i) => el.addEventListener('click', () => open(i)));
  }

  function setFocusable(enabled: boolean) {
    const val = enabled ? '0' : '-1';
    closeBtn?.setAttribute('tabindex', val);
    prevBtn?.setAttribute('tabindex', val);
    nextBtn?.setAttribute('tabindex', val);
    lightbox?.setAttribute('aria-hidden', enabled ? 'false' : 'true');
  }

  function open(i: number) {
    idx = i;
    update();
    lightbox?.classList.add('active');
    setFocusable(true);
    document.body.style.overflow = 'hidden';
  }

  function close() {
    lightbox?.classList.remove('active');
    setFocusable(false);
    document.body.style.overflow = '';
  }

  function update() {
    if (!lbImage || !lbCaption) return;
    lbImage.src = imgs[idx].src;
    lbImage.alt = imgs[idx].alt;
    lbCaption.textContent = imgs[idx].caption;
    if (prevBtn) prevBtn.disabled = idx === 0;
    if (nextBtn) nextBtn.disabled = idx === imgs.length - 1;
  }

  function nav(dir: number) {
    idx = Math.max(0, Math.min(imgs.length - 1, idx + dir));
    update();
  }

  closeBtn?.addEventListener('click', close);
  backdrop?.addEventListener('click', close);
  prevBtn?.addEventListener('click', () => nav(-1));
  nextBtn?.addEventListener('click', () => nav(1));

  document.addEventListener('keydown', (e) => {
    if (!lightbox?.classList.contains('active')) return;
    if (e.key === 'Escape') close();
    if (e.key === 'ArrowLeft') nav(-1);
    if (e.key === 'ArrowRight') nav(1);
  });

  init();
</script>
